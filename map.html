<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>世界地图 - 二氧化碳排放量（时间轴）</title>
    <!-- 引入 echarts.js 和 papaparse.js -->
    <script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>

<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main" style="width: 2000px; height: 1000px;"></div>
    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById('main'));

        // 使用 PapaParse 解析本地 CSV 文件
        Papa.parse('Data/CO2_GDP/CO2.csv', {
            download: true,
            header: true,
            complete: function (results) {
                var data = results.data;
                var allColumns = Object.keys(data[0]);
                var years = allColumns.filter(column => column !== 'Country Name'); // Filter out the 'Country Name' column

                console.log("Available years:", years); // 输出所有解析到的年份，检查是否正确

                var options = [];

                years.forEach(function (year) {
                    var seriesData = [];
                    data.forEach(function (item) {
                        var value = item[year];
                        if (value !== undefined && value !== '') {
                            seriesData.push({
                                name: item['Country Name'],
                                value: parseFloat(value)
                            });
                        }
                    });

                    if (seriesData.length > 0) { // 确保数据存在
                        options.push({
                            title: {
                                text: '世界地图 - ' + year + '年二氧化碳排放量'
                            },
                            series: [{
                                data: seriesData
                            }]
                        });
                    }
                });

                fetch('./Data/world.geojson').then(response => response.json()).then(geoJson => {
                    echarts.registerMap('world', geoJson);
                    var option = {
                        baseOption: {
                            timeline: {
                                axisType: 'category',
                                autoPlay: true,
                                playInterval: 1000,
                                data: years,
                                tooltip: {
                                    formatter: function (params) {
                                        return params.name;  // Just show the year
                                    }
                                }
                            },
                            tooltip: {
                                trigger: 'item',
                                formatter: '{b}: {c}'
                            },
                            visualMap: {
                                min: 0,
                                max: 1000000,  // Adjust based on the maximum value in your data if needed
                                left: 'left',
                                top: 'bottom',
                                text: ['高', '低'],  // Text for the top and bottom of the scale bar
                                calculable: true
                            },
                            series: [{
                                name: 'CO2 Emissions',
                                type: 'map',
                                mapType: 'world',
                                roam: true,
                                label: {
                                    show: false  // Set to true if you want country names to show up on the map
                                }
                            }]
                        },
                        options: options
                    };



                    myChart.setOption(option);
                }).catch(error => {
                    console.error('Error loading geojson file:', error);
                });
            }
        });
    </script>
</body>

</html>